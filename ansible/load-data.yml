---
- name: Setup atlasDB Atlas Cluster
  hosts: all
  gather_facts: no
  vars:
    local_data_file: "../data/student_grades.json"
    local_fix_dates_file: "../data/fix-dates.js"
    local_create_index_file: "../data/create-index.js"

  tasks:
  - name: Import data into MongoDB using mongoimport
    command: >
      mongoimport --uri "{{ atlas_connection_string }}/{{ atlas_database_name }}"
                  --username "{{ atlas_proj_pub_key }}"
                  --password "{{ atlas_proj_priv_key }}"
                  --collection "{{ atlas_collection_name }}"
                  --file "{{ local_data_file }}"
                  --type json

  - name: Execute the fix-dates.js JavaScript file using atlassh
    command: >
      mongosh "{{ atlas_connection_string }}/{{ atlas_database_name }}"
              --file "{{ local_fix_dates_file }}"
              --username "{{ atlas_proj_pub_key }}"
              --password "{{ atlas_proj_priv_key }}"

  - name: Execute create-index.js JavaScript file using atlassh
    command: >
      mongosh "{{ atlas_connection_string }}/{{ atlas_database_name }}"
              --file "{{ local_create_index_file }}"
              --username "{{ atlas_proj_pub_key }}"
              --password "{{ atlas_proj_priv_key }}"

